# 批量编辑 API Keys 测试实例

## 测试目标
验证批量编辑功能中的账户选择和共享账号池功能是否正常工作

## 测试环境
- 服务地址: http://localhost:3000
- 管理员账号: admin / admin

## 测试前准备

### 1. 确保有测试账户
请确保系统中至少有以下账户类型：
- 1个Claude专属账户
- 1个Gemini专属账户  
- 1个账户分组（任意平台）

### 2. 创建测试用的API Keys
创建至少3个API Keys用于测试，建议配置：
- API Key 1: 绑定Claude专属账户
- API Key 2: 绑定Gemini专属账户
- API Key 3: 使用共享账号池

## 测试步骤

### 第一部分：验证账户显示功能

#### 步骤1：检查单个API Key的账户绑定显示
1. 登录管理后台: http://localhost:3000/admin-next
2. 进入"API Keys管理"页面
3. 检查每个API Key的绑定信息显示是否正确：
   - 绑定专属账户的应显示"🔒 专属-账户名"
   - 绑定分组的应显示"分组-分组名"
   - 未绑定的应显示"使用共享池"
   - 新增的Bedrock绑定信息应正常显示

**预期结果：** 所有账户绑定信息显示正确

#### 步骤2：验证Bedrock账户显示
1. 如果有Bedrock账户，检查是否正确显示橙色标签
2. 检查移动端视图下是否也正确显示

**预期结果：** Bedrock账户信息正确显示

### 第二部分：批量编辑核心功能测试

#### 步骤3：选择多个API Keys进行批量编辑
1. 选中至少2个API Keys（勾选复选框）
2. 点击"编辑选中 (X个)"按钮
3. 检查批量编辑弹窗是否正常打开

**预期结果：** 批量编辑弹窗正常显示

#### 步骤4：验证账户选择选项
检查每个平台的账户选择下拉框是否包含：
1. **Claude专属账号**下拉框：
   - "不修改"选项
   - "使用共享账号池"选项  
   - 账号分组（如果有）
   - 专属账号列表，区分OAuth和Console

2. **Gemini专属账号**下拉框：
   - "不修改"选项
   - "使用共享账号池"选项
   - 账号分组（如果有）
   - 专属账号列表

3. **OpenAI专属账号**下拉框：
   - "不修改"选项
   - "使用共享账号池"选项
   - 账号分组（如果有）
   - 专属账号列表

4. **Bedrock专属账号**下拉框：
   - "不修改"选项
   - "使用共享账号池"选项
   - 专属账号列表（Bedrock暂不支持分组）

**预期结果：** 所有平台都包含正确的选项

### 第三部分：批量修改为共享账号池

#### 步骤5：测试改为使用共享账号池
1. 在Claude专属账号中选择"使用共享账号池"
2. 在Gemini专属账号中选择"使用共享账号池"
3. 点击"批量保存"
4. 等待操作完成

**预期结果：** 
- 显示成功提示
- 弹窗自动关闭
- 选中状态被清空

#### 步骤6：验证修改结果
1. 查看刚才选中的API Keys
2. 检查账户绑定信息是否变为"使用共享池"

**预期结果：** API Keys的绑定信息已更新为"使用共享池"

### 第四部分：批量绑定专属账户

#### 步骤7：测试绑定专属账户
1. 重新选中相同的API Keys
2. 打开批量编辑弹窗
3. 选择一个Claude专属账户
4. 选择一个Gemini专属账户
5. 点击"批量保存"

**预期结果：** 操作成功完成

#### 步骤8：验证绑定结果
检查API Keys是否正确绑定到选定的专属账户

**预期结果：** 绑定信息正确更新

### 第五部分：混合场景测试

#### 步骤9：测试部分修改
1. 选中3个API Keys
2. 在批量编辑中：
   - Claude专属账号：选择一个具体账户
   - Gemini专属账号：保持"不修改"
   - OpenAI专属账号：选择"使用共享账号池"
3. 保存并验证结果

**预期结果：** 
- 只有Claude和OpenAI绑定被修改
- Gemini绑定保持原状

#### 步骤10：测试权限限制功能
1. 在批量编辑中设置"服务权限"为"仅Claude"
2. 检查Gemini和OpenAI选项是否被禁用
3. 改为"仅Gemini"，检查Claude和OpenAI是否被禁用

**预期结果：** 权限限制正常工作，不相关平台的选项被禁用

### 第六部分：错误处理测试

#### 步骤11：测试网络中断场景
1. 在批量编辑过程中模拟网络中断
2. 检查错误处理是否正确

#### 步骤12：测试大量数据
1. 如果可能，选择10+个API Keys进行批量编辑
2. 检查性能和稳定性

## 测试检查点

### 功能检查点
- [ ] 单个API Key账户绑定信息显示正确
- [ ] Bedrock账户信息正确显示
- [ ] 批量编辑弹窗正常打开
- [ ] 所有平台账户选项完整显示
- [ ] "使用共享账号池"功能正常
- [ ] 专属账户绑定功能正常
- [ ] "不修改"选项正常工作
- [ ] 权限限制功能正常
- [ ] 批量操作成功提示正确
- [ ] 选中状态管理正确

### 用户体验检查点
- [ ] 界面响应速度合理
- [ ] 操作流程直观易懂
- [ ] 错误信息清晰明确
- [ ] 移动端适配正常
- [ ] 无明显UI错误

### 数据一致性检查点
- [ ] 前端显示与后端数据一致
- [ ] 批量操作结果准确
- [ ] 账户绑定状态正确
- [ ] 无数据丢失或错误

## 常见问题排查

### 如果"使用共享账号池"选项不显示
1. 检查浏览器控制台是否有JS错误
2. 确认前端代码已正确构建
3. 刷新页面重试

### 如果批量编辑失败
1. 检查浏览器网络面板的API调用
2. 查看服务器日志：`tail -f logs/claude-relay-*.log`
3. 确认选中的API Keys数量是否合理

### 如果账户绑定信息显示错误
1. 检查账户数据是否正确加载
2. 确认账户类型标识是否正确
3. 刷新页面重新加载数据

## 测试完成标准

所有功能检查点通过，且：
1. 批量编辑的各项功能均正常工作
2. 账户选择和绑定逻辑正确
3. 共享账号池功能按预期工作
4. 用户界面友好，无明显问题
5. 数据一致性得到保证

## 测试报告模板

```
# 批量编辑功能测试报告

## 测试环境
- 测试时间：[填写时间]
- 浏览器：[填写浏览器版本]
- 测试数据：[描述使用的账户和API Keys]

## 测试结果
### 通过的功能
- [列出正常工作的功能]

### 发现的问题
- [详细描述遇到的问题]

### 改进建议
- [提出改进意见]

## 总体评价
[整体功能评价和建议]
```